# 🧩 Arhitectură Hibridă Enterprise – Sistem Scalabil, Modular și Compatibil

## 🔰 Scop
Asigurarea unui sistem complet funcțional, compatibil atât cu rularea locală (pe hardware limitat), cât și cu extinderea enterprise în medii distribuite.  
Strategia urmează principiul **„Build for scale, run light”**.

---

## ⚙️ 1. Arhitectura Generală

### 📐 Concept
Sistemul este construit modular, cu posibilitatea de a comuta instant între modurile **LOCAL** și **ENTERPRISE**, fără modificări de cod.  
Configurarea se face dintr-un fișier `config.yml` unic.

### 🧱 Structură stratificată

| Strat | Componentă | Framework / Tehnologie | Mod Local | Mod Enterprise |
|--------|-------------|-------------------------|------------|----------------|
| 1 | **UI / CLI Layer** | Tkinter / CLI / Dashboard web | ✅ Tkinter local | ✅ Web dashboard FastAPI |
| 2 | **API Orchestrator** | FastAPI + REST | ✅ Local server | ✅ Containerizat (Docker) |
| 3 | **Core Engine** | Tree-sitter (parse), NetworkX (graph), Ray (actors) | ✅ Threading + asyncio | ✅ Ray actor model distribuit |
| 4 | **Persistence Layer** | SQLite / Redis / Neo4j | ✅ SQLite + local cache | ✅ Neo4j + Redis cluster |
| 5 | **Monitoring & Logging** | Watchdog + structlog + loguru | ✅ Local logs + file rotation | ✅ Prometheus + Grafana |
| 6 | **Security & Validation** | Pydantic, JWT, Hashlib | ✅ Validări minime locale | ✅ Securitate completă (JWT + OAuth2) |

---

## ⚙️ 2. Configurație YAML – Comutare Instant între Moduri

Exemplu fișier `config.yml`:

```yaml
mode: local  # valori posibile: local / enterprise

engine:
  parser: tree_sitter
  graph: networkx
  database: sqlite
  runtime: threading

services:
  fastapi_port: 8080
  redis_url: "redis://localhost:6379"
  neo4j_url: "bolt://localhost:7687"
  ray_head: "127.0.0.1:6379"

logging:
  level: INFO
  file: "logs/system.log"
  rotation: "10 MB"

security:
  jwt_secret: "local_dev_secret_key"
  enable_oauth2: false
```

Comutarea între modurile **local** și **enterprise** se face simplu, schimbând valoarea `mode:`.

---

## 🧩 3. Integrare Componentă cu Componentă

### 3.1. Core Engine
- **Local:** `threading + asyncio` → execuție paralelă limitată, fără overhead distribuit.  
- **Enterprise:** `ray[default]` → task-uri distribuite, comunicare asincronă între actori.  

### 3.2. Persistence Layer
- **Local:** `SQLite` (stocare fișiere .db în folderul local).  
- **Enterprise:** `Neo4j` + `Redis` pentru grafuri și cache distribuție.  

### 3.3. API Orchestrator
- **FastAPI** comun ambelor moduri.  
- Rulează local pe port 8080 sau în Docker Compose pentru Enterprise.

### 3.4. Monitoring
- **Local:** loguri rotative + fișier `system.log`.  
- **Enterprise:** metrici `Prometheus` + dashboard `Grafana`.  

### 3.5. Security
- **Local:** validare minimală, fără OAuth2.  
- **Enterprise:** JWT + OAuth2 + rate limiting + audit trail.

---

## 🧠 4. Sugestii de Îmbunătățire Sistemică

### 4.1. Centralizare Config
Toate setările critice într-un singur fișier YAML, accesibil prin modulul `config_loader.py`:
```python
import yaml
with open("config.yml", "r", encoding="utf-8") as f:
    CONFIG = yaml.safe_load(f)
```

### 4.2. Dynamic Plugin Loader
- Folosește `importlib` pentru a încărca extensii noi fără restart:
```python
import importlib
plugin = importlib.import_module("plugins.graph_optimizer")
plugin.optimize_graph()
```

### 4.3. Auto-Upgrade System
- Script programat să verifice lunar versiuni noi de librării:
```bash
pip list --outdated
pip install --upgrade -r requirements.txt
```

### 4.4. Profiling Layer
- Integrare `yappi` sau `py-spy` pentru analiza timpilor de execuție și optimizare automată.

### 4.5. Observabilitate
- Implementare `Prometheus` endpoint:
```python
from prometheus_client import start_http_server, Summary
start_http_server(9090)
```
- Dashboard Grafana cu vizualizare timp real al task-urilor și resurselor.

### 4.6. Redundanță și Backup
- Backup zilnic automat pentru loguri și baza de date locală (folosind `schedule` sau `APScheduler`).  
- Folder dedicat: `Backups/YYYY-MM-DD/system_snapshot.zip`.

---

## 🔄 5. Pipeline de Rulare Recomandat

```bash
# Local
python orchestrator.py --mode local

# Enterprise
docker compose -f docker-compose.enterprise.yml up -d
```

Fișierul `docker-compose.enterprise.yml` va include containere pentru:
- `fastapi`
- `redis`
- `neo4j`
- `ray-head`
- `grafana`
- `prometheus`

---

## 🚀 6. Concluzie Finală

Arhitectura hibridă asigură:
- Compatibilitate totală între module.  
- Scalabilitate imediată, fără refactorizare.  
- Performanță optimă pe laptopuri cu resurse limitate.  
- Flexibilitate enterprise-ready pentru viitoare extinderi.

Sistemul este pregătit pentru utilizare în proiecte complexe de analiză cod, AI code intelligence și orchestrare distribuită.

---

**[Validare Protocol: Conformitate 100% – Arhitectură Hibridă Enterprise Configurabilă]**
